# Alertmanager configuration
# This is a basic configuration for development/testing

global:
  # Global SMTP settings
  # smtp_smarthost: 'smtp.example.org:587'
  # smtp_from: 'alertmanager@example.org'
  # smtp_auth_username: 'alertmanager'
  # smtp_auth_password: 'password'
  
  # Resolve timeout - how long to wait before marking alert as resolved
  resolve_timeout: 5m

# Route configuration
route:
  # Default receiver
  receiver: 'default-receiver'
  
  # Group alerts by these labels
  group_by: ['alertname', 'severity', 'node_label']
  
  # Wait before sending initial notification for a new group
  group_wait: 30s
  
  # Wait before sending subsequent notifications for an existing group
  group_interval: 5m
  
  # Wait before re-sending a notification about the same alert group
  repeat_interval: 4h
  
  # Child routes for specific handling
  routes:
    # Critical alerts - faster notification
    - receiver: 'critical-receiver'
      matchers:
        - severity="critical"
      group_wait: 10s
      repeat_interval: 1h
    
    # Major alerts
    - receiver: 'major-receiver'
      matchers:
        - severity="major"
      repeat_interval: 2h
    
    # OpenNMS specific routing
    - receiver: 'opennms-receiver'
      matchers:
        - source="opennms"
      continue: true

# Inhibition rules
inhibit_rules:
  # Inhibit warning alerts if critical alert is firing for same node
  - source_matchers:
      - severity="critical"
    target_matchers:
      - severity="warning"
    equal: ['alertname', 'node_label']
  
  # Inhibit minor alerts if major is firing
  - source_matchers:
      - severity="major"
    target_matchers:
      - severity="minor"
    equal: ['alertname', 'node_label']

# Receivers configuration
receivers:
  # Default receiver - just logs to Alertmanager
  - name: 'default-receiver'
    # webhook_configs:
    #   - url: 'http://webhook-receiver:5001/'
    #     send_resolved: true
  
  # Critical alerts receiver
  - name: 'critical-receiver'
    # email_configs:
    #   - to: 'critical-alerts@example.org'
    #     send_resolved: true
    # pagerduty_configs:
    #   - service_key: '<your-pagerduty-key>'
    #     send_resolved: true
  
  # Major alerts receiver
  - name: 'major-receiver'
    # email_configs:
    #   - to: 'major-alerts@example.org'
    #     send_resolved: true
  
  # OpenNMS specific receiver
  - name: 'opennms-receiver'
    # slack_configs:
    #   - api_url: 'https://hooks.slack.com/services/xxx/xxx/xxx'
    #     channel: '#opennms-alerts'
    #     send_resolved: true
    #     title: '{{ .Status | toUpper }}: {{ .CommonLabels.alertname }}'
    #     text: |
    #       *Alert:* {{ .CommonLabels.alertname }}
    #       *Severity:* {{ .CommonLabels.severity }}
    #       *Node:* {{ .CommonLabels.node_label }}
    #       *Description:* {{ .CommonAnnotations.description }}
    #       *Runbook:* {{ .CommonAnnotations.runbook }}

# Templates (optional)
# templates:
#   - '/etc/alertmanager/templates/*.tmpl'
