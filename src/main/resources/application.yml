spring:
  application:
    name: opennms-alertmanager-bridge
  
  # Kafka Configuration
  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    consumer:
      group-id: ${KAFKA_CONSUMER_GROUP:opennms-alertmanager-bridge}
      auto-offset-reset: earliest
      enable-auto-commit: true
      auto-commit-interval: 1000
      # Increase fetch size for better throughput
      max-poll-records: 500
      fetch-min-size: 1
      fetch-max-wait: 500ms
    properties:
      # Security configuration (if needed)
      # security.protocol: SASL_SSL
      # sasl.mechanism: PLAIN
      # sasl.jaas.config: org.apache.kafka.common.security.plain.PlainLoginModule required username="${KAFKA_USER}" password="${KAFKA_PASSWORD}";

# OpenNMS Bridge Configuration
opennms:
  bridge:
    # Alertmanager settings
    alertmanager:
      url: ${ALERTMANAGER_URL:http://localhost:9093}
      api-path: /api/v2/alerts
      connect-timeout: 5s
      read-timeout: 10s
      enabled: ${ALERTMANAGER_ENABLED:true}
      retry:
        max-attempts: 3
        backoff: 1s
    
    # Kafka topics
    topics:
      alarms: ${KAFKA_TOPIC_ALARMS:alarms}
      nodes: ${KAFKA_TOPIC_NODES:nodes}
      events: ${KAFKA_TOPIC_EVENTS:events}
    
    # Alert configuration
    alert:
      # How often to resend active alerts (Alertmanager expects continuous updates)
      resend-interval: ${ALERT_RESEND_INTERVAL:60000}
      # How long to keep resolved alerts info
      resolved-retention: 5m
      
      # Static labels added to all alerts
      static-labels:
        source: opennms
        environment: ${ENVIRONMENT:production}
      
      # Label mapping configuration
      label-mappings:
        include-node-metadata: true
        node-metadata-prefix: opennms_meta_
        include-node-categories: true
        categories-label: opennms_categories
      
      # Annotation mapping configuration
      annotation-mappings:
        include-node-details: true
        node-details-key: opennms_node
        include-description: true
        include-operator-instructions: true
      
      # Severity filter (empty = all severities)
      # Possible values: critical, major, minor, warning, info, resolved, unknown
      include-severities: []
      
      # UEIs to exclude from forwarding
      exclude-ueis: []
    
    # OpenNMS settings
    opennms:
      base-url: ${OPENNMS_URL:http://localhost:8980/opennms}

# Server Configuration
server:
  port: ${SERVER_PORT:8080}

# Actuator endpoints
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}

# Logging
logging:
  level:
    root: INFO
    com.example.opennms: ${LOG_LEVEL:INFO}
    org.apache.kafka: WARN
    org.springframework.kafka: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
